<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrar - MaraTour</title>
    <link rel="stylesheet" href="../../css/global.css">
    <link rel="stylesheet" href="../../css/login.css">
</head>

<body>
<div id="root"></div>
<header class="cabecalho">
    <nav class="cabecalho-menu centralizar">
        <a class="menu-iniciar centralizar" href="../../index.html"><img src="../../assets/icons/maranhao-logo.svg" alt="bandeira do Maranhão"> MARATOUR</a>

        <div class="menu-botoes centralizar">
            <a class="menu-botao centralizar"> <img src="../../assets/icons/icon-perfil.svg"> ENTRAR </a>
        </div>
    </nav>
</header>

<main>
    <form id="login-form" class="login-box centralizar">
        <div class="formulario-box">
            <div><label>EMAIL</label></div>
            <input type="email" name="email" id="email" placeholder="seu@email.com">
            <p class="erro" id="email-required-error">Email obrigatório</p>
            <p class="erro" id="email-invalid-error">Email inválido</p>
        </div>

        <div class="formulario-box">
            <div><label>SENHA</label></div>
            <input type="password" name="senha" id="senha" placeholder="senha">
            <p class="erro" id="password-required-error">Senha obrigatória</p>
        </div>

        <div>
            <button type="button" id="recover-password-button" class="recuperar">Esqueceu a senha</button>
        </div>

        <div class="login-botoes centralizar">
            <button type="submit" id="login-button" class="login">ENTRAR</button>
            <button type="button" class="registrar" id="registrar">REGISTRAR</button>
        </div>
    </form>
</main>
</body>
<script src="../../app.js"></script>
<script src="../../js/carregamento.js"></script>
<script>
    document.getElementById("login-form").addEventListener("submit", async function (e) {
        e.preventDefault();

        const email = document.getElementById("email").value;
        const senha = document.getElementById("senha").value;

        const response = await fetch("http://localhost:3000/auth/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({email, senha})
        });

        const data = await response.json();

        if (response.ok) {
            // Salvando o token no localStorage
            localStorage.setItem("token", data.token);
            showLoading();
            // Redirecionar para a página principal
            window.location.href = "../../index.html";
        } else {
            alert(data.msg);
        }
    });
</script>
<script src="../../js/index.js"></script>
</html>
